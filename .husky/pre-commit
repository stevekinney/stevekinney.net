#!/bin/sh
set -e

# Collect staged files
STAGED_FILES="$(git diff --cached --name-only --diff-filter=ACMRTUXB)"
if [ -z "$STAGED_FILES" ]; then
  echo "No staged files; skipping pre-commit checks."
  exit 0
fi

# Audit frontmatter for staged course files first
COURSE_FILES="$(git diff --cached --name-only --diff-filter=ACMRTUXB -- 'courses/**/*.md')"
if [ -n "$COURSE_FILES" ]; then
  echo "Auditing frontmatter (title/description) for staged course files..."
  bun run --cwd packages/scripts audit-courses-frontmatter.ts $COURSE_FILES
  git add $COURSE_FILES
fi

bunx lint-staged
